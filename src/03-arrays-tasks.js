function findElement(arr, value) {
  return arr.indexOf(value);
}


function generateOdds(len) {
  const def = [1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31];

  def.splice(len);

  return def;
}


function doubleArray(arr) {
  return [...arr, ...arr];
}


function getArrayOfPositives(arr) {
  return arr.filter((item) => item > 0);
}

/**
 * Returns the array with strings only in the specified array (in original order)
 *
 * @param {array} arr
 * @return {array}
 *
 * @example
 *    [ 0, 1, 'cat', 3, true, 'dog' ] => [ 'cat', 'dog' ]
 *    [ 1, 2, 3, 4, 5 ] => []
 *    [ 'cat, 'dog', 'raccoon' ] => [ 'cat', 'dog', 'raccoon' ]
 */
function getArrayOfStrings(arr) {
  return arr.filter((item) => typeof item === 'string');
}


function removeFalsyValues(arr) {
  return arr.filter((item) => item);
}


function getUpperCaseStrings(arr) {
  return arr.map((item) => item.toUpperCase());
}


function getStringsLength(arr) {
  return arr.map((item) => item.length);
}


function insertItem(arr, item, index) {
  return arr.splice(index, 0, item);
}


function getHead(arr, n) {
  return arr.slice(0, n);
}


/**
 * Returns the n last items of the specified array
 *
 * @param {array} arr
 * @param {number} n
 *
 * @example
 *    [ 1, 3, 4, 5 ], 2  => [ 4, 5 ]
 *    [ 'a', 'b', 'c', 'd'], 3  => [ 'b', 'c', 'd' ]
 */
function getTail(arr, n) {
  return arr.slice(arr.length - n);
}


function toCsvText(arr) {
  let string = '';

  function f(i) {
    if (i !== arr.length - 1) {
      string += `${arr[i]}\n`;
    } else {
      string += `${arr[i]}`;
    }
  }

  arr.map((item, i) => f(i));


  return string;
}


function toArrayOfSquares(arr) {
  return arr.map((i) => i ** 2);
}


function getMovingSum(arr) {
  return arr.map((item, index) => arr.slice(0, +index + 1).reduce((acc, curr) => acc + curr, 0));
}

/**
 * Returns every second item from the specified array:
 *
 * @param {array} arr
 * @return {array}
 *
 * Example :
 * [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ] => [ 2, 4, 6, 8, 10 ]
 * [ 'a', 'b', 'c' , null ]  => [ "b", null ]
 * [ "a" ] => []
 */
function getSecondItems(arr) {
  return arr.filter((item, index) => index % 2 !== 0);
}


/**
 * Propagates every item in sequence its position times
 * Returns an array that consists of: one first item, two second items, tree third items etc.
 *
 * @param {array} arr
 * @return {array}
 *
 * @example :
 *  [] => []
 *  [ 1 ] => [ 1 ]
 *  [ 'a', 'b' ] => [ 'a', 'b','b' ]
 *  [ 'a', 'b', 'c', null ] => [ 'a', 'b','b', 'c','c','c',  null,null,null,null ]
 *  [ 1,2,3,4,5 ] => [ 1, 2,2, 3,3,3, 4,4,4,4, 5,5,5,5,5 ]
 */
function propagateItemsByPositionIndex(arr) {
  return arr.map((item, index) => Array(index + 1).fill(item)).flat();
}


/**
 * Returns the 3 largest numbers from the specified array
 *
 * @param {array} arr
 * @return {array}
 *
 * @example
 *   [] => []
 *   [ 1, 2 ] => [ 2, 1 ]
 *   [ 1, 2, 3 ] => [ 3, 2, 1 ]
 *   [ 1,2,3,4,5,6,7,8,9,10 ] => [ 10, 9, 8 ]
 *   [ 10, 10, 10, 10 ] => [ 10, 10, 10 ]
 */
function get3TopItems(arr) {
  if (arr.length < 3) {
    return arr.reverse();
  }
  const sort = arr.sort((a, b) => a - b).reverse();
  return [sort[0], sort[1], sort[2]];
}


function getPositivesCount(arr) {
  return arr.filter((item) => {
    if (typeof item === 'number' && item > 0) {
      return item;
    }
    return false;
  }).length;
}


function sortDigitNamesByNumericOrder(arr) {
  const numsLiterals = {
    zero: 0,
    one: 1,
    two: 2,
    three: 3,
    four: 4,
    five: 5,
    six: 6,
    seven: 7,
    eight: 8,
    nine: 9,
  };
  const LiteralsNums = Object.keys(numsLiterals);
  const numsArray = arr.map((i) => numsLiterals[i]).sort().map((item) => LiteralsNums[item]);
  return numsArray;
}

/**
 * Returns the sum of all items in the specified array of numbers
 *
 * @param {array} arr
 * @return {number}
 *
 * @example
 *   [] => 0
 *   [ 1, 2, 3 ]           => 6
 *   [ -1, 1, -1, 1 ]      => 0
 *   [ 1, 10, 100, 1000 ]  => 1111
 */
function getItemsSum(arr) {
  return arr.reduce((acc, curr) => acc + curr, 0);
}

/**
 * Returns the number of all falsy value in the specified array
 *
 * @param {array} arr
 * @return {array}
 *
 * @example
 *  [] => 0
 *  [ 1, '', 3 ] => 1
 *  [ -1, 'false', null, 0 ] => 2
 *  [ null, undefined, NaN, false, 0, '' ]  => 6
 */
function getFalsyValuesCount(arr) {
  return arr.filter((item) => Boolean(item) === false).length;
}

/**
 * Returns a number of all occurences of the specified item in an array
 *
 * @param {array} arr
 * @param {any} item
 * @return {number}
 *
 * @example
 *    [ 0, 0, 1, 1, 1, 2 ], 1 => 3
 *    [ 1, 2, 3, 4, 5 ], 0 => 0
 *    [ 'a','b','c','c' ], 'c'=> 2
 *    [ null, undefined, null ], null => 2
 *    [ true, 0, 1, 'true' ], true => 1
 */
function findAllOccurences(arr, item) {
  return arr.filter((i) => item === i).length;
}


function toStringList(arr) {
  return arr.toString();
}


function sortCitiesArray(arr) {
  return arr.sort((a, b) => {
    if (a.country > b.country) return 1;
    if (a.country < b.country) return -1;
    if (a.city > b.city) return 1;
    if (a.city < b.city) return -1;
    return 0;
  });
}

/**
 * Creates an indentity matrix of the specified size
 *
 * @param {number} n
 * @return {array}
 *
 * @example
 *     1  => [[1]]
 *
 *     2 => [[1,0],
 *           [0,1]]
 *
 *          [[1,0,0,0,0],
 *           [0,1,0,0,0],
 *     5 =>  [0,0,1,0,0],
 *           [0,0,0,1,0],
 *           [0,0,0,0,1]]
 */
function getIdentityMatrix(n) {
  const arr = Array(n);
  arr.fill(0);
  const cell = Array(n);
  cell.fill(0);
  return arr.map((item, i) => {
    const newCell = [...cell];
    newCell[i] = 1;
    return newCell;
  });
}

/**
 * Creates an array of integers from the specified start to end (inclusive)
 *
 * @param {number} start
 * @param {number} end
 * @return {array}
 *
 * @example
 *     1, 5  => [ 1, 2, 3, 4, 5 ]
 *    -2, 2  => [ -2, -1, 0, 1, 2 ]
 *     0, 100 => [ 0, 1, 2, ..., 100 ]
 *     3, 3   => [ 3 ]
 */
function getIntervalArray(start, end) {
  const result = new Array(end - start);
  result.fill(0);

  return result.reduce((previous) => {
    previous.push(previous[previous.length - 1] + 1);

    return previous;
  }, [start]);
}


/**
 * Returns array containing only unique values from the specified array.
 *
 * @param {array} arr
 * @return {array}
 *
 * @example
 *   [ 1, 2, 3, 3, 2, 1 ] => [ 1, 2, 3 ]
 *   [ 'a', 'a', 'a', 'a' ]  => [ 'a' ]
 *   [ 1, 1, 2, 2, 3, 3, 4, 4] => [ 1, 2, 3, 4]
 */
function distinct(arr) {
  return Array.from(new Set(arr));
}

/**
 * Groups elements of the specified array by key.
 * Returns multimap of keys extracted from array elements via keySelector callback
 * and values extracted via valueSelector callback.
 * See: https://en.wikipedia.org/wiki/Multimap
 *
 * @param {array} array
 * @param {Function} keySelector
 * @param {Function} valueSelector
 * @return {Map}
 *
 * @example
 *   group([
 *      { country: 'Belarus', city: 'Brest' },
 *      { country: 'Russia', city: 'Omsk' },
 *      { country: 'Russia', city: 'Samara' },
 *      { country: 'Belarus', city: 'Grodno' },
 *      { country: 'Belarus', city: 'Minsk' },
 *      { country: 'Poland', city: 'Lodz' }
 *     ],
 *     item => item.country,
 *     item => item.city
 *   )
 *            =>
 *   Map {
 *    "Belarus" => ["Brest", "Grodno", "Minsk"],
 *    "Russia" => ["Omsk", "Samara"],
 *    "Poland" => ["Lodz"]
 *   }
 */
function group(array, keySelector, valueSelector) {
  return array.reduce((previous, current) => {
    const key = keySelector(current);
    const value = valueSelector(current);
    const keys = previous.get(key) || [];
    keys.push(value);
    previous.set(key, keys);
    return previous;
  }, new Map());
}


/**
 * Projects each element of the specified array to a sequence
 * and flattens the resulting sequences into one array.
 *
 * @param {array} arr
 * @param {Function} childrenSelector, a transform function to apply to each element
 *                                     that returns an array of children
 * @return {array}
 *
 * @example
 *   [[1, 2], [3, 4], [5, 6]], (x) => x     =>   [ 1, 2, 3, 4, 5, 6 ]
 *   ['one','two','three'], x=>x.split('')  =>   ['o','n','e','t','w','o','t','h','r','e','e']
 */
function selectMany(arr, childrenSelector) {
  return arr.reduce((acc, curr) => {
    const child = childrenSelector(curr);

    return acc.concat(child);
  }, []);
}


function getElementByIndexes(arr, indexes) {
  let value = arr;
  indexes.map((item) => {
    value = value[item];
    return true;
  });
  return value;
}


function swapHeadAndTail(arr) {
  const { length } = arr;
  const result = [];

  if (length % 2 === 0) {
    return result.concat(arr.slice(length / 2, length), arr.slice(0, length / 2));
  }
  return result.concat(arr.slice(length / 2 + 1, length),
    arr[parseInt(length / 2, 10)], arr.slice(0, length / 2));
}

module.exports = {
  findElement,
  generateOdds,
  doubleArray,
  getArrayOfPositives,
  getArrayOfStrings,
  removeFalsyValues,
  getUpperCaseStrings,
  getStringsLength,
  insertItem,
  getHead,
  getTail,
  toCsvText,
  toStringList,
  toArrayOfSquares,
  getMovingSum,
  getSecondItems,
  propagateItemsByPositionIndex,
  get3TopItems,
  getPositivesCount,
  sortDigitNamesByNumericOrder,
  getItemsSum,
  getFalsyValuesCount,
  findAllOccurences,
  sortCitiesArray,
  getIdentityMatrix,
  getIntervalArray,
  distinct,
  group,
  selectMany,
  getElementByIndexes,
  swapHeadAndTail,
};
